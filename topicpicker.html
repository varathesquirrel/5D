<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>5D Topic Picker</title>
 <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/5052/5052297.png" type="image/x-icon">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        transition: background 0.3s, color 0.3s;
    }

    body.dark {
        background: #1e1e1e;
        color: white;
    }

    /* Main container */
    .main {
        flex: 1;
        padding: 20px;
        position: relative;
        overflow: hidden;
    }

    /* Topic card */
#topicCardContainer {
    position: relative;
    width: 100%;
    height: 550px; /* same as minimum height you want */
}

/* Base card style */
.topicCard {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;

    margin: 30px 100px 30px 100px;
    padding: 40px;
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    color: white;
    border-radius: 16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    font-size: 36px;

    display: flex;
    align-items: center;
    justify-content: center;

    opacity: 1;
    z-index: 1;
    transition: opacity 0.3s ease;
}

/* New card enters from bottom and scales slightly */
.slide-in-from-bottom {
    animation: slideInCard 0.3s ease forwards;
}

@keyframes slideInCard {
    0% {
        transform: translateY(40px) scale(0.97);
        opacity: 0;
    }
    100% {
        transform: translateY(0px) scale(1);
        opacity: 1;
    }
}

/* Layout for title + subtitle */
.topic-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
	 word-wrap: break-word;
}

.topic-title {
    font-size: 80px;
    font-weight: bold;
    margin-bottom: 10px;
}

.topic-subtitle {
    font-size: 42px;
    opacity: 0.9;
}


    /* Buttons row */
    .controls {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    button {
        padding: 10px 16px;
        border: none;
        background: #333;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }

    button:hover {
        background: #555;
    }

    /* Settings panel (gear icon toggles) */
    #settingsPanel {
        margin-top: 15px;
        padding: 12px;
        border-radius: 10px;
        background: #ddd;
        display: none;
    }
    body.dark #settingsPanel {
        background: #333;
        color: white;
    }

    /* History panel */
    .history-panel {
        width: 320px;
        background: #fff;
        border-left: 2px solid #ccc;
        overflow-y: auto;
        padding: 20px;
        transition: width 0.3s ease, padding 0.3s ease;
        resize: horizontal;
        min-width: 220px;
        max-width: 600px;
    }
    body.dark .history-panel {
        background: #2b2b2b;
        border-color: #444;
    }

    /* Collapsed state */
    .history-collapsed {
        width: 0 !important;
        min-width: 0 !important;
        max-width: 0 !important;
        padding: 0 !important;
        overflow: hidden;
        border: none !important;
    }

    /* History content list */
    #historyList div {
        padding: 8px;
        border-bottom: 1px solid #aaa;
    }

    /* Floating collapse/expand button */
    #collapseHistoryBtn {
        position: absolute;
        right: -5px;
        top: 30%;
        transform: translateY(-50%);
        background: #222;
        color: white;
        border-radius: 50%;
        padding: 6px;
        width: 34px;
        height: 34px;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    #collapseHistoryBtn:hover {
        background: #444;
    }
	
	#collapseHistoryBtn {
    position: absolute;
    right: -5px;
    top: 50%;
    transform: translateY(-50%);
    background: #222;
    color: white; /* default for light mode */
    border-radius: 50%;
    padding: 6px;
    width: 34px;
    height: 34px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: background 0.3s, color 0.3s;
}

body.dark #collapseHistoryBtn {
    color: #fff; /* sets icon to white in dark mode */
    background: #444; /* optional: darker background for dark mode */
}


/* Sliding card animation */
.slide-in {
    animation: slideIn 0.45s ease forwards;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(40px) scale(0.97);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}
#paragraph{
    font-size: 35px;
    max-height: 800px;  /* smaller than card height to leave padding */
    overflow-y: auto;
    text-align: left;
    width: 100%;
    padding-right: 25px;  /* prevent text under scrollbar */
}

#paragraph::-webkit-scrollbar {
    width: 8px;
}

#paragraph::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.4);
    border-radius: 4px;
}


</style>
</head>

<body>

<!-- MAIN SECTION -->
<div class="main">

    <!-- Floating Collapse Button -->
<button id="collapseHistoryBtn">
    <svg id="collapseIcon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
        <!-- Arrow pointing LEFT (expand) -->
        <path d="M15 6l-6 6 6 6"/>
    </svg>
</button>


    <div class="controls">
        <button onclick="pickTopic()">Pick Topic</button>
        <button onclick="toggleSettings()">⚙️ Settings</button>
        <span id="timerDisplay" style="margin-left:auto; font-size:20px;">00:00</span>
    </div>

    <!-- Topic card -->
    <div id="topicCardContainer">
		<div class="topicCard" id="cardA">Click on "Pick Topic"</div>
		<div class="topicCard" id="cardB">Click on "Pick Topic"</div>
	</div>


    <!-- Settings dropdown -->
    <div id="settingsPanel">
        <label><input type="checkbox" id="darkModeToggle" checked> Dark Mode</label><br><br>
        <label><input type="checkbox" id="noRepeatToggle" checked> Do Not Repeat Topics</label><br><br>

        Timer:
        <input type="number" id="timerMinutes" value="3" min="0" style="width:60px;"> min
        <input type="number" id="timerSeconds" value="0" min="0" max="59" style="width:60px;"> sec
		<div>
    <label>
        <input type="checkbox" id="bigBookLineToggle"> Random Big Book Line
    </label>
    <input type="checkbox" id="showParagraphBtn" style="display:none;" checked>Show full paragraph</input>
</div>
<br>
    </div>
	<div id="paragraph">
	</div>
</div>

<!-- HISTORY PANEL -->
<div class="history-panel history-collapsed">
    <h2>History</h2>
    <div id="historyList"></div>
</div>

<!-- Topics Array -->
<script src="topics.js"></script>
<script src="bigBookLines.js"></script>
<script src="bigBookParagraphs.js"></script>

<script>
    let usedTopics = new Set();
    let timerInterval = null;

    // Collapse history by default
    const historyPanel = document.querySelector(".history-panel");
    const collapseBtn = document.getElementById("collapseHistoryBtn");
    const collapseIcon = document.getElementById("collapseIcon");

    // Collapse / Expand Logic
    collapseBtn.onclick = () => {
        if (historyPanel.classList.contains("history-collapsed")) {
            historyPanel.classList.remove("history-collapsed");
            collapseIcon.style.transform = "scale(-1,1)"; // arrow right
        } else {
            historyPanel.classList.add("history-collapsed");
            collapseIcon.style.transform = "scale(1,1)"; // arrow left
        }
    };

    // Toggle settings panel
    function toggleSettings() {
        const p = document.getElementById("settingsPanel");
        p.style.display = p.style.display === "block" ? "none" : "block";
    }

    // Dark Mode
	document.body.classList.toggle("dark", this.checked);
    document.getElementById("darkModeToggle").onchange = function() {
        document.body.classList.toggle("dark", this.checked);
    };
const cardColors = [
    ["#4facfe", "#00f2fe"],
    ["#43e97b", "#38f9d7"],
    ["#fa709a", "#fee140"],
    ["#30cfd0", "#330867"],
    ["#a18cd1", "#fbc2eb"],
    ["#f6d365", "#fda085"],
    ["#5ee7df", "#b490ca"]
];
function fitTopicCard(card) {
    const title = card.querySelector(".topic-title");
    const subtitle = card.querySelector(".topic-subtitle");

    if (!title || !subtitle) return;

    let titleFont = 80;   // starting font size for title
    let subtitleFont = 42; // starting font size for subtitle

    // Set initial font sizes
    title.style.fontSize = titleFont + "px";
    subtitle.style.fontSize = subtitleFont + "px";

    // Compute max available height
    const maxHeight = card.clientHeight - 20; // leave some padding
    const maxWidth = card.clientWidth - 20;

    // Shrink title/subtitle until both fit
    while ((title.scrollHeight + subtitle.scrollHeight > maxHeight || 
            title.scrollWidth > maxWidth || subtitle.scrollWidth > maxWidth) && titleFont > 12) {
        titleFont -= 1;
        subtitleFont = Math.max(subtitleFont - 0.5, 10); // shrink subtitle proportionally
        title.style.fontSize = titleFont + "px";
        subtitle.style.fontSize = subtitleFont + "px";
    }
}


function randomCardGradient() {
    const pair = cardColors[Math.floor(Math.random() * cardColors.length)];
    return `linear-gradient(135deg, ${pair[0]}, ${pair[1]})`;
}
let showingCardA = true;

function renderTopicIntoCard(card, topic) {
    card.style.background = randomCardGradient();
    card.innerHTML = `
        <div class="topic-content">
            <div class="topic-title">${topic.title||topic.line}</div>
            <div class="topic-subtitle">${topic.subtitle || topic.page ||""}</div>
        </div>
    `;
	fitTopicCard(card);
}
function pickTopicOld(){
        if (!topics || topics.length === 0) {
            alert("No topics loaded!");
            return;
        }

        let available = topics;

        if (document.getElementById("noRepeatToggle").checked) {
            available = topics.filter(t => !usedTopics.has(t.title));
            if (available.length === 0) {
                alert("All topics used!");
                return;
            }
        }

        const chosen = available[Math.floor(Math.random() * available.length)];
		

        usedTopics.add(chosen.title);
        addToHistory(chosen.title);
		pickTopicFinal(chosen);
}

    // Pick Topic
    function pickTopicFinal(chosen) {

const cardA = document.getElementById("cardA");
const cardB = document.getElementById("cardB");

const incoming = showingCardA ? cardB : cardA;
const outgoing = showingCardA ? cardA : cardB;

// Render topic into incoming card
renderTopicIntoCard(incoming, chosen);

// Reset animation class so it can replay
incoming.classList.remove("slide-in-from-bottom");
void incoming.offsetWidth; // force reflow

// Bring incoming card on top
incoming.style.zIndex = 2;
outgoing.style.zIndex = 1;

// Animate
incoming.classList.add("slide-in-from-bottom");

// After animation ends, swap roles
setTimeout(() => {
    outgoing.style.zIndex = 1;
    incoming.style.zIndex = 2;
    showingCardA = !showingCardA;
}, 450);



        startTimer();
    }

    function addToHistory(text) {
        const list = document.getElementById("historyList");
        const div = document.createElement("div");
        div.textContent = text;
        list.prepend(div);
    }

    // Timer
    function startTimer() {
        const min = parseInt(document.getElementById("timerMinutes").value);
        const sec = parseInt(document.getElementById("timerSeconds").value);

        let total = min * 60 + sec;
        const display = document.getElementById("timerDisplay");

        if (timerInterval) clearInterval(timerInterval);

        function update() {
            const m = String(Math.floor(total / 60)).padStart(2, "0");
            const s = String(total % 60).padStart(2, "0");
            display.textContent = `${m}:${s}`;

            if (total <= 0) {
                clearInterval(timerInterval);
                return;
            }
            total--;
        }

        update();
        timerInterval = setInterval(update, 1000);
    }
	

let lastPickedParagraphId = null;
let lastPickedLine=null;

        document.getElementById("showParagraphBtn").style.display = 'inline-block';


document.getElementById("showParagraphBtn").onchange = function() {
if(!document.getElementById("showParagraphBtn").checked)
document.getElementById("paragraph").innerHTML="";
    if (!lastPickedParagraphId) return;
    const para = bigBookParagraphs.find(p => p.paragraphId === lastPickedParagraphId);
    if (para)	document.getElementById("paragraph").innerHTML=`${highlighted}<pre>${para.chapter||""}pp. ${para.page||""}</pre>`;
};

function pickTopic() {
    if (document.getElementById("bigBookLineToggle").checked) {
        const chosen = bigBookLines[Math.floor(Math.random() * bigBookLines.length)];

        pickTopicFinal(chosen);

        lastPickedParagraphId = chosen.paragraphId;
		lastPickedLine=chosen.line;
		if(document.getElementById("showParagraphBtn").checked){
        document.getElementById("showParagraphBtn").style.display = 'inline-block';
    const para = bigBookParagraphs.find(p => p.paragraphId === lastPickedParagraphId);
    if (!para)return;
	// Escape regex special chars in line
    const escapedLine = lastPickedLine.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

    // Replace first occurrence of the line with bolded version
    const highlighted = para.text.replace(
        new RegExp(escapedLine),
        `<strong>${lastPickedLine}</strong>`
    );

	document.getElementById("paragraph").innerHTML=`${highlighted}<pre>${para.chapter||""} (pp. ${para.page||""})</pre>`;
	}
        return;
    }

    // Existing topic picker logic...
	pickTopicOld();
}

</script>

</body>
</html>
